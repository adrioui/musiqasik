services:
  surrealdb:
    image: surrealdb/surrealdb:v2.4.0
    container_name: musiqasik-surrealdb
    command: start --log info --user root --pass root --bind 0.0.0.0:8000 memory
    ports:
      - "8000:8000"
    environment:
      - SURREAL_STRICT=false
    healthcheck:
      # `/health` is not stable across SurrealDB versions; use JSON-RPC ping instead.
      test: ["CMD", "curl", "-sf", "http://localhost:8000/rpc", "-H", "Content-Type: application/json", "-d", "{\"method\":\"ping\",\"params\":[]}"]
      interval: 5s
      timeout: 3s
      retries: 10
      start_period: 5s
    restart: unless-stopped
